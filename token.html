<!DOCTYPE html>
<html>
  <head>
    <title>Redirecting...</title>
    <meta charset="UTF-8" />
    <script>
      // Extract purchase_id from Gumroad
      const params = new URLSearchParams(window.location.search);
      const purchaseId = params.get("purchase_id");

      if (purchaseId) {
        // Store token with expiry (1 hour)
        const expiry = Date.now() + 3600 * 1000;
        const token = JSON.stringify({ id: purchaseId, expiry });
        localStorage.setItem("access_token", token);

        // Redirect to secured viewer
        window.location.href = "/index.html";
      } else {
        document.write("Invalid redirect. No purchase ID found.");
      }
    </script>
  </head>
  <body></body>
</html>
